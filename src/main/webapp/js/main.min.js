;

jQuery( function() {
    $("body").on('click','[data-stopPropagation]',function (e) {
        e.stopPropagation();
    });

    // 滚动条
    const ps = new PerfectScrollbar('.lyear-layout-sidebar-scroll', {
        swipeEasing: false,
        suppressScrollX: true
    });
	
	 /*Bootstrap 3：在页面刷新时保持选中的选项卡*/
    $(document).ready(function() {
        if (location.hash) {
            $("a[href='" + location.hash + "']").tab("show");
        }
        $(document.body).on("click", "a[data-toggle='tab']", function(event) {
            location.hash = this.getAttribute("href");
        });});$(window).on("popstate", function() {
        var anchor = location.hash || $("a[data-toggle='tab']").first().attr("href");
        $("a[href='" + anchor + "']").tab("show");});

    // 侧边栏
    $(".lyear-aside-toggler").bind('click', function(){
        $('.lyear-layout-sidebar').toggleClass('lyear-aside-open');
        $("body").toggleClass('lyear-layout-sidebar-close');

        if ($('.lyear-mask-modal').length == 0) {
            $('<div class="lyear-mask-modal"></div>').prependTo('body');
        } else {
            $( '.lyear-mask-modal' ).remove();
        }
        $('.lyear-mask-modal').on( 'click', function() {
            $( this ).remove();
            $('.lyear-layout-sidebar').toggleClass('lyear-aside-open');
            $('body').toggleClass('lyear-layout-sidebar-close');
        });
    });

    // 侧边栏导航
    $( '.nav-item-has-subnav > a' ).on( 'click', function() {
        $subnavToggle = jQuery( this );
        $navHasSubnav = $subnavToggle.parent();
        $topHasSubNav = $subnavToggle.parents('.nav-item-has-subnav').last();
        $subnav       = $navHasSubnav.find('.nav-subnav').first();
        $viSubHeight  = $navHasSubnav.siblings().find('.nav-subnav:visible').outerHeight();
        $scrollBox    = $('.lyear-layout-sidebar-scroll');
        $navHasSubnav.siblings().find('.nav-subnav:visible').slideUp(500).parent().removeClass('open');
        $subnav.slideToggle( 300, function() {
            $navHasSubnav.toggleClass( 'open' );
            // 新增滚动条处理
            var scrollHeight  = 0;
            pervTotal     = $topHasSubNav.prevAll().length,
                boxHeight     = $scrollBox.outerHeight(),
                innerHeight   = $('.sidebar-main').outerHeight(),
                thisScroll    = $scrollBox.scrollTop(),
                thisSubHeight = $(this).outerHeight(),
                footHeight    = 121;

            if (footHeight + innerHeight - boxHeight >= (pervTotal * 48)) {
                scrollHeight = pervTotal * 48;
            }
            if ($subnavToggle.parents('.nav-item-has-subnav').length == 1) {
                $scrollBox.animate({scrollTop: scrollHeight}, 300);
            } else {
                // 子菜单操作
                if (typeof($viSubHeight) != 'undefined' && $viSubHeight != null) {
                    scrollHeight = thisScroll + thisSubHeight - $viSubHeight;
                    $scrollBox.animate({scrollTop: scrollHeight}, 300);
                } else {
                    if ((thisScroll + boxHeight - $scrollBox[0].scrollHeight) == 0) {
                        scrollHeight = thisScroll - thisSubHeight;
                        $scrollBox.animate({scrollTop: scrollHeight}, 300);
                    }
                }
            }
        });
    });

    // 提示
    if($('[data-toggle="tooltip"]')[0]) {
        $('[data-toggle="tooltip"]').tooltip({
            "container" : 'body',
        });
    }

    // 弹出框
    if($('[data-toggle="popover"]')[0]) {
        $('[data-toggle="popover"]').popover();
    }

    
    // 复选框全选
    $("#check-all").change(function () {
        $("input[type='checkbox']").prop('checked', $(this).prop("checked"));
    });

});

//菜单
$(function () {
    initMenu();
    //openMenu();
    //console.log(location.pathname);
});

/*function openMenu() {
    var pathName = location.pathname;
    if (pathName == "/admin/article/" || pathName == "/admin/article/insert"
        || pathName == "/admin/category" || pathName == "/admin/tags") {
        $("#articleNav").addClass("active open");
    }
}*/

function initMenu() {
    //var regex = /\d/;
    //console.log(regex.test(6));
    // var str = "123"
    // console.log(str.indexOf("2") != -1); // true
    var pathName = location.pathname;
    if (pathName.indexOf('/admin/category')!= -1) {
        pathName = "/admin/category";
    }
    if (pathName.indexOf("/admin/tags") != -1) {
        pathName = "/admin/tags";
    }
    if (pathName.indexOf("/admin/article") != -1 && pathName != '/admin/article/insert') {
        pathName = "/admin/article";
    }
    if (pathName.indexOf("/admin/link") != -1) {
        pathName = "/admin/link";
    }
    if (pathName.indexOf("/admin/comment") != -1) {
        pathName = "/admin/comment";
    }
    if (pathName.indexOf("/admin/article/edit") != -1) {
        pathName = "/admin/article/insert";
    }
    if (pathName.indexOf("/admin/notice") != -1) {
        pathName = "/admin/notice";
    }
    if (pathName == "/admin/user/edit") {
        pathName = "/admin/user";
    }
    $(".nav-subnav").children().each(function () {
        var li = $(this);
        // console.log(li)
        li.find('a').each(function () {
            var href = $(this).attr("href");
            //alert(href);
            if (pathName == href) {
                //li.addClass("active");
                $(this).parent().addClass("active");
                //$(this).parent().parent().parent().addClass("active open");
            } else {
                //li.removeClass("active");
                $(this).parent().removeClass("active");
                //$(this).parent().parent().parent().addClass("active open");
            }
        });
    });
}
